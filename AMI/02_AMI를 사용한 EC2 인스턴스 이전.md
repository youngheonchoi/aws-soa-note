## **EC2 AMI 마이그레이션, 공유 및 복사**  

### **1. EC2 인스턴스 AZ 간 마이그레이션**  
- **AMI를 이용하여 EC2 인스턴스를 한 가용 영역(AZ)에서 다른 AZ로 이동 가능**  
- 예: `us-east-1a`에서 `us-east-1b`로 이동하려면  
  1. **현재 EC2 인스턴스에서 AMI 생성**  
  2. **생성된 AMI를 사용하여 새로운 AZ에서 EC2 인스턴스 실행**  
- 동일한 데이터, 파일 시스템, 애플리케이션이 유지됨  

<br>

### **2. AMI의 교차 계정 공유**  
- AMI를 다른 AWS 계정과 공유해도 **소유권은 유지됨**  
- **암호화되지 않은 AMI**:  
  - 다른 계정과 공유 가능  
  - 또는 AMI를 공개적으로 공유 가능  
- **암호화된 AMI**:  
  - KMS(Customer Managed Key, CMK)로 암호화 필요  
  - 공유하려면 **해당 KMS 키도 함께 공유해야 함**  
  - 대상 계정이 볼륨을 사용하려면 **해독 및 재암호화 권한 필요**  

<br>

### **3. AMI 복사 (Copy AMI)**  
- 공유된 AMI를 복사하면, **복사한 계정이 새롭게 소유권을 가짐**  
- **EBS 스냅샷 접근 권한 필요**  
- 대상 계정에서 `CopyImage` API를 호출해 소스 AMI를 복사 가능  
- 복사 과정에서 **자체 KMS 키를 사용하여 재암호화 가능**  
- **암호화된 AMI를 복사하려면**:  
  1. 원본 AMI의 KMS 키 공유  
  2. 대상 계정에서 복사 및 재암호화 진행  

<br>

### **4. AMI 공유 설정 및 관리**  
- **AMI 권한 편집 (Edit AMI Permissions)**  
  - AWS 콘솔에서 **"Action - Edit AMI permissions"** 선택  
  - `Private` 설정 시 특정 **계정 ID, 조직(Organization), OU(Organizational Unit)과 공유 가능**  
  - `Public` 설정 시 **모든 사용자에게 공개되므로 주의 필요**  
- **스냅샷 권한 추가 가능**  
  - 공유된 계정이 **해당 스냅샷을 사용하여 인스턴스를 실행할 수 있도록 허용**  

<br>

### **결론**  
✅ **AZ 간 이동** : AMI를 생성 후 다른 AZ에서 새 EC2 인스턴스로 복원  
✅ **AMI 공유** : 암호화되지 않은 경우 바로 공유 가능, 암호화된 경우 KMS 키도 공유 필요  
✅ **AMI 복사** : 공유된 AMI를 복사하면 소유권 변경됨, KMS 암호화된 경우 키 권한 필요  
✅ **권한 관리** : AMI 공유 대상 및 권한을 신중하게 설정해야 함  