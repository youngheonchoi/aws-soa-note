## CloudFormation 롤백(Rollback) 기능 정리

CloudFormation에서 스택 생성 또는 업데이트 중 오류가 발생하면 **롤백(Rollback)** 메커니즘이 작동하여 **안정적인 상태**로 되돌립니다. 상황에 따라 롤백의 동작 방식이 다르므로, 이를 이해하는 것이 **시험과 실무에 매우 중요**합니다.

---

### ✅ 스택 생성 실패 시 롤백 옵션

스택 생성 도중 실패하면 두 가지 옵션이 있습니다:

1. **기본 옵션 (전체 롤백)**

   * 생성된 **모든 리소스가 삭제됨**
   * 실패 원인 파악은 로그를 통해 가능하지만 **리소스를 직접 확인할 수는 없음**

2. **롤백 비활성화 (리소스 유지)**

   * **성공한 리소스는 유지**, 실패한 부분만 문제 발생
   * 실패한 리소스를 **수동 디버깅 및 수정 가능**
   * 실습이나 테스트에서 문제 원인을 분석할 때 유용

---

### ✅ 스택 업데이트 실패 시 롤백 동작

* **업데이트 실패 시 기본 동작**
  → **마지막 정상 상태**로 되돌아감 (이전 리소스 유지, 신규 리소스 삭제)

* **롤백 실패 상황**
  → 중간에 수동 변경된 리소스 등으로 인해 **롤백 자체도 실패**할 수 있음
  → **수동 개입 필요**

* **복구 방법**:
  `ContinueUpdateRollback`

  * 콘솔, CLI, API에서 사용 가능
  * CloudFormation에게 롤백을 다시 시도하도록 지시

---

### ✅ 실습 예시 요약

#### 1. 실패 트리거 템플릿 생성

* 예: 잘못된 AMI ID 입력
* 스택 옵션:

  * 전체 롤백
  * 리소스 유지 중 하나 선택 가능
* 결과:

  * 전체 롤백 선택 시: 모든 리소스 삭제됨
  * 리소스 유지 선택 시: 실패 리소스만 문제 발생, 나머지 리소스 유지됨

#### 2. 실패 발생 후 수정 & 재시도

* 스택 업데이트 후 실패 발생 → 설정한 롤백 정책에 따라 동작
* 리소스 유지 시 **잔여 리소스 남음**

  * 이후 삭제하려면 수동 정리 필요

---

### ✅ 시험 대비 핵심 포인트

| 상황                | 동작              | 유의사항                        |
| ----------------- | --------------- | --------------------------- |
| **스택 생성 중 오류 발생** | 기본적으로 전체 리소스 삭제 | 리소스 확인 불가                   |
| **롤백 비활성화**       | 성공한 리소스 유지      | 수동으로 문제 분석 가능               |
| **스택 업데이트 중 오류**  | 마지막 정상 상태로 롤백   | 새 리소스 삭제됨                   |
| **롤백 실패**         | 수동 개입 필요        | `ContinueUpdateRollback` 사용 |
| **리소스 유지 옵션**     | 성공한 리소스 유지      | 이후 수동 수정 필요 가능              |

---

### ✅ 정리

* **롤백 기본 동작**: 오류 발생 시 전체 삭제 (기본값)
* **옵션 조정 가능**: 리소스를 유지하며 디버깅
* **중단된 스택**: 수동으로 롤백 재시작 필요
* **실습 추천**: 잘못된 템플릿으로 실패 유도 → 두 옵션 모두 테스트
* **시험 포인트**: **스택 생성/업데이트 실패 시 동작**, `ContinueUpdateRollback` 활용법
