## CloudFormation과 보안: 서비스 역할 및 iam\:PassRole 이해

CloudFormation에서 **IAM 역할**을 사용하는 것은 보안 및 권한 관리를 위한 핵심 기능입니다. 사용자에게 직접 리소스를 생성할 권한을 부여하지 않고도 **CloudFormation을 통해** 리소스를 안전하게 관리할 수 있습니다.

---

### ✅ 서비스 역할(Service Role)이란?

* **CloudFormation 전용 IAM 역할**로, 사용자를 대신해 **스택 리소스 생성/업데이트/삭제 작업**을 수행할 수 있도록 해주는 역할입니다.
* **CloudFormation 콘솔, CLI, API에서 선택적으로 지정**할 수 있습니다.
* 지정하지 않으면 사용자의 권한으로 스택 작업이 수행됩니다.

---

### ✅ 서비스 역할 사용 목적

* **최소 권한 원칙(Least Privilege)** 유지 가능
  → 사용자는 직접 리소스를 만들 수 없지만, CloudFormation이 역할을 통해 리소스를 생성함
* **보안 분리**
  → 사용자 권한과 스택 리소스 권한을 분리하여 관리

---

### ✅ 서비스 역할을 사용한 작동 흐름

1. 사용자는 `iam:PassRole` 권한을 통해 특정 IAM 역할을 CloudFormation에 **위임**할 수 있음
2. CloudFormation은 해당 역할을 이용해 리소스 생성/삭제 수행
3. 역할에는 필요한 서비스 작업 권한(e.g. `s3:*`)이 포함되어 있어야 함

---

### ✅ iam\:PassRole이란?

* 사용자가 **CloudFormation에 IAM 역할을 전달**하려면 반드시 이 권한이 필요합니다.
* `iam:PassRole`은 \*\*어떤 역할을 다른 AWS 서비스에 전달(위임)\*\*할 수 있는지 제어합니다.
* 사용자는 역할 내부의 정책 권한까지 가질 필요는 없습니다.

---

### ✅ 실습 예시 요약

#### 1. 서비스 역할 생성

* IAM → 역할 생성 → **AWS 서비스: CloudFormation** 선택
* 권한: 예시로 `AmazonS3FullAccess` 부여
* 이름: `DemoRoleForCFNWithS3Capabilities`

#### 2. CloudFormation에서 스택 생성 시 역할 사용

* 템플릿 업로드 후 스택 생성 과정에서 **IAM 역할 선택** 가능
* 역할 선택 시 **사용자 권한이 아닌 지정한 역할의 권한**으로 리소스가 생성됨
* 예: 역할이 S3 권한만 갖고 있을 경우, **EC2 인스턴스 생성은 실패**

---

### ✅ 시험 대비 핵심 포인트

| 항목                | 설명                                                        |
| ----------------- | --------------------------------------------------------- |
| **서비스 역할**        | CloudFormation이 사용자를 대신해 리소스를 생성/삭제할 수 있도록 하는 IAM 역할      |
| **iam\:PassRole** | 사용자가 CloudFormation에 역할을 전달할 수 있도록 허용하는 IAM 권한            |
| **사용 이유**         | 최소 권한 원칙을 준수하며 사용자 권한을 제한하고 CloudFormation에만 리소스 관리 권한 부여 |
| **권한 적용 방식**      | 스택 생성 시 명시적으로 IAM 역할을 지정하거나 생략 가능 (생략 시 사용자 권한 사용)        |
| **실패 예시**         | 역할에 S3 권한만 있을 경우 EC2 생성 스택은 실패 (EC2 권한 없음)                |

---

### ✅ 실무 팁

* `iam:PassRole`을 너무 넓게 설정하면 보안 위험이 큽니다 → **리소스 수준 제한을 걸어야 안전**
* DevOps 자동화 시 필수 설정 요소
* **CloudFormation 서비스 역할을 SSM, RDS, ECS, Lambda 등과 연계**하면 보안과 유지보수성이 크게 향상됨