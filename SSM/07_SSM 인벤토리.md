## SSM 인벤토리

SSM 인벤토리는 **관리형 인스턴스(EC2 또는 온프레미스)** 로부터 다양한 **메타데이터를 수집** 하여, 인프라 상태를 체계적으로 파악할 수 있도록 도와줍니다. 수집 대상에는 소프트웨어, OS 구성, 패치 상태, 실행 중인 서비스 등이 포함됩니다.

<br>

## 수집 가능한 정보
- 설치된 소프트웨어 목록
- OS 및 드라이버 정보
- 구성 세부사항
- 패치 및 업데이트 내역
- 실행 중인 서비스 상태

<br>

## 데이터 활용 방식
- 수집된 인벤토리 데이터는 **AWS 콘솔에서 직접 확인** 가능
- **Amazon S3에 저장**하여 백업 또는 장기 분석 가능
- **Athena**를 이용해 서버리스 쿼리로 분석 수행
- **QuickSight**를 활용해 시각화 대시보드 구성 가능

<br>

## 인벤토리 설정 및 작동 방식
1. **Inventory 활성화**: 콘솔에서 관리형 인스턴스에 대해 인벤토리를 활성화
2. **State Manager와 연결**: Inventory는 내부적으로 **State Manager**를 통해 실행됨
3. **State 정의 및 스케줄링**: 수집 주기(분/시간/일) 설정 및 상태 유지 자동화
4. **실행 결과 확인**: 콘솔에서 인벤토리 활성화 및 수집 성공 여부 확인 가능

<br>

## State Manager란?
State Manager는 EC2 인스턴스가 **정의된 상태를 지속적으로 유지**하도록 도와주는 자동화 도구입니다.

### 사용 예시:
- 특정 소프트웨어 자동 설치
- 포트 설정 또는 보안 규칙 자동화
- OS 패치 및 업데이트 스케줄 관리
- CloudWatch 에이전트 배포 등

### 작동 방식:
- **SSM 문서**를 기반으로 구성
- **연결(Association)**을 통해 인스턴스에 적용
- 스케줄 지정 및 상태 모니터링 가능

<br>

## 사용자 지정 인벤토리 및 동기화
- **사용자 지정 인벤토리 항목 생성** 가능 (예: 복제 설정, 내부 구성 요소 등)
- 수집된 인벤토리 데이터를 **Amazon S3에 동기화**
- **리소스 데이터 동기화(Resource Data Sync)** 생성 필요

### 구성 절차:
1. **S3 버킷 생성**
2. **동기화 구성 (Sync 이름, 버킷 이름 지정)**
3. **S3 버킷 정책 설정** (SSM이 객체를 저장할 수 있도록 권한 부여)
4. **Athena에서 쿼리 실행 가능**

<br>

## 권한 설정 (S3 버킷 정책 예시)
- SSM이 S3 버킷에 데이터를 업로드할 수 있도록 **Bucket Policy** 구성
- 다음 항목을 포함해야 함:
  - SSM 서비스에 대한 `s3:PutObject` 권한
  - 적절한 버킷 이름 및 프리픽스
  - 계정 ID 설정

<br>

## 분석 예시
- Amazon Linux 2를 사용하는 인스턴스 수 확인
- 상위 설치 애플리케이션 5개 조회
- 인스턴스별 설치된 소프트웨어의 버전, 아키텍처, 게시자, 릴리스 등 메타데이터 열람 가능
- 수천 개의 EC2 인스턴스에서도 유용하게 사용 가능

<br>

## 고급 기능
- **Athena 연동**으로 복잡한 SQL 기반 분석 가능
- 8~9 페이지 이상의 결과도 필터링 및 검색 가능
- 다양한 조건으로 인벤토리 데이터 조회 가능

<br>

## 정리
SSM 인벤토리를 통해 AWS 리소스에 대한 상태 정보를 주기적으로 수집하고 중앙에서 분석할 수 있습니다. State Manager와의 연계를 통해 대상 인스턴스의 일관된 상태 유지가 가능하며, Amazon S3와 Athena를 통한 확장성 있는 데이터 활용도 가능합니다. 인프라의 보안, 패치, 구성 상태를 체계적으로 관리하고 싶은 경우 강력한 도구가 될 수 있습니다.