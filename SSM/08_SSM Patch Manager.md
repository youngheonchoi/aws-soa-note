## SSM Patch Manager

**SSM Patch Manager**는 AWS에서 관리형 인스턴스(EC2 또는 온프레미스)의 **운영체제 및 애플리케이션 패치를 자동화**하는 기능입니다. 보안 패치, OS 업데이트, 소프트웨어 패치를 일정 또는 수동으로 실행할 수 있어 **지속적인 컴플라이언스 유지**에 효과적입니다.

<br>

## 지원 대상
- **인스턴스 유형**: EC2 및 온프레미스 서버
- **운영 체제**: Windows, Linux, macOS
- **실행 방식**:
  - **온디맨드 실행** (즉시 실행)
  - **Maintenance Windows를 통한 예약 실행** (스케줄 기반)

<br>

## 작동 흐름
1. Patch Manager가 **인스턴스를 스캔**
2. **패치 기준**에 따라 설치 여부 판단
3. **규정 준수(Compliance) 보고서 생성**
4. 보고서는 **Amazon S3로 전송** 가능
5. 결과에 따라 조치 가능

<br>

## 핵심 구성 요소

### 1. 패치 기준 (Patch Baseline)
- 어떤 패치를 **허용(승인)** 또는 **거부**할지를 정의
- 패치 승인 조건을 설정 가능 (예: 릴리스 후 X일 내 자동 승인)
- 기본 패치 기준: 중요 및 보안 관련 패치만 포함
- **사용자 지정 기준**을 만들어 다양한 운영 체제 및 패치 리포지토리 지원 가능

### 2. 패치 그룹 (Patch Group)
- **인스턴스에 태그를 붙여 특정 패치 기준과 연결**
- 하나의 인스턴스는 하나의 패치 그룹에만 속할 수 있음
- 예: Dev, Test, Prod 환경별 패치 그룹 구성 가능

<br>

## 실행 방식
- **SSM 문서(AWS-RunPatchBaseline)** 를 사용하여 인스턴스에 패치를 실행
- 콘솔, CLI, SDK, 또는 **Maintenance Windows**를 통해 실행 가능
- SSM Agent가 Patch Manager에 쿼리하여 설치할 패치 목록을 받아 실행

<br>

## 예시 구성
```plaintext
세 개의 EC2 인스턴스 (모두 Windows OS)
- 첫 번째 인스턴스: 태그 = Patch Group: Dev → 패치 기준 ID = PB98
- 두 번째 인스턴스: 태그 없음 → 기본 패치 기준 ID = PB0123
- 세 번째 인스턴스: Patch Group: Prod → 기본 기준 사용 = PB0123
```
- 태그를 기준으로 패치 기준이 다르게 적용됨
- 각 인스턴스에 맞는 기준으로 패치 설치 여부가 결정됨

<br>

## Maintenance Windows
- **작업 실행 일정**을 설정하는 기능
- 예: 매주 새벽 3시~5시 사이에 패치 실행
- 구성 요소:
  - 스케줄 (주기)
  - 기간 (타임 윈도우)
  - 등록된 인스턴스 목록
  - 실행할 작업 문서 목록 (예: 패치 설치)

<br>

## 속도 제어 (Rate Control)
- 패치를 적용할 때 인스턴스별로 **속도 제어** 가능
- 예: 한 번에 하나의 인스턴스씩 순차 실행
- 에러 발생 시 자동 중단 기능도 설정 가능

<br>

## 사용자 지정 리포지토리
- SSM Patch Manager는 **사내 커스텀 리포지토리**도 연동 가능
- 필요 시 AWS 외부의 패치 서버를 통해도 패치 적용 가능

<br>

## 정리
Patch Manager는 AWS 인프라의 **보안 및 안정성 유지를 위한 핵심 도구**입니다. 운영 체제별로 패치 기준을 정의하고, 태그 기반으로 인스턴스를 그룹화하여 패치 적용을 자동화합니다. 유지 관리 창(Maintenance Windows)을 활용하면 운영 중단을 최소화하며 계획된 시간에 작업을 수행할 수 있어, 대규모 환경에서도 유연하고 체계적인 패치 운영이 가능합니다.