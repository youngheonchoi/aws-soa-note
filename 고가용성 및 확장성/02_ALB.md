## Application Load Balancer (ALB)

**Application Load Balancer(ALB)** 는 AWS에서 제공하는 **7계층(HTTP/HTTPS) 전용 로드 밸런서**입니다. 다양한 URL 경로, 호스트 이름, 쿼리 문자열 등에 따라 트래픽을 세부적으로 라우팅할 수 있으며, **마이크로서비스 아키텍처와 컨테이너 기반 서비스에 최적화**되어 있습니다.

<br>

## 주요 특징
- **HTTP, HTTPS, WebSocket, HTTP/2 지원**
- URL 경로, 호스트 이름, 헤더, 쿼리 문자열 기반 라우팅 가능
- **HTTP → HTTPS 자동 리다이렉트 지원**
- 하나의 로드 밸런서로 **다수 애플리케이션 트래픽 처리 가능**
- 대상 그룹(Target Group) 단위로 상태 확인(Health Check)
- EC2, ECS, Lambda, IP 주소를 대상으로 라우팅 가능

<br>

## 라우팅 방식

### ① 경로 기반 라우팅 (Path-based Routing)
- 예: `example.com/users` → 대상 그룹 A  
  `example.com/search` → 대상 그룹 B

### ② 호스트 기반 라우팅 (Host-based Routing)
- 예: `one.example.com` → 대상 그룹 A  
  `other.example.com` → 대상 그룹 B

### ③ 쿼리 문자열/헤더 기반 라우팅
- 예: `example.com/home?platform=mobile` → 모바일용 대상 그룹  
  `?platform=desktop` → 데스크탑용 대상 그룹

<br>

## 대상 그룹(Target Group)이란?
ALB가 트래픽을 분산시키는 대상들의 모음입니다. 아래와 같은 리소스가 대상이 될 수 있습니다.

| 대상 그룹 유형 | 설명 |
|----------------|------|
| **EC2 인스턴스** | 일반적인 웹/앱 서버 구성 |
| **ECS 태스크** | 컨테이너 기반 서비스 (포트 매핑 기능 활용 가능) |
| **Lambda 함수** | 이벤트 기반 서버리스 컴퓨팅 |
| **IP 주소** | 온프레미스 서버 또는 VPC 외부 대상 (사설 IP만 가능) |

> 대상 그룹별로 헬스 체크(상태 확인)와 리스폰스 조건을 정의할 수 있습니다.

<br>

## 마이크로서비스 아키텍처에서의 활용
- 하나의 ALB가 여러 마이크로서비스로 트래픽을 분리 라우팅 가능
- 예:  
  `/users` → 유저 서비스  
  `/search` → 검색 서비스  
- 각각의 서비스는 **독립된 대상 그룹**으로 관리됨

<br>

## ALB와 포트 매핑
- ECS 사용 시 ALB는 **컨테이너가 사용하는 동적 포트로 트래픽 전달** 가능
- 이는 ECS에서 자동 생성된 포트를 인식하고 트래픽을 전달하는 기능
- **컨테이너 기반 환경에서는 ALB가 사실상 필수**

<br>

## 클라이언트 IP 확인 방법
ALB는 자체 IP로 백엔드에 통신하므로, **EC2 인스턴스에서는 클라이언트의 원래 IP를 직접 알 수 없습니다.**

이를 보완하기 위해 ALB는 다음 **HTTP 헤더**를 제공합니다:

| 헤더 | 설명 |
|-------|------|
| `X-Forwarded-For` | 클라이언트의 실제 IP |
| `X-Forwarded-Port` | 클라이언트가 사용한 포트 |
| `X-Forwarded-Proto` | HTTP 또는 HTTPS 여부 |

> 애플리케이션 로직에서 이 헤더들을 파싱하여 클라이언트 정보를 추출해야 합니다.

<br>

## ALB vs CLB 비교

| 항목 | CLB (Classic) | ALB (Application) |
|------|----------------|-------------------|
| 지원 계층 | 4 & 7계층 | 7계층 (HTTP 전용) |
| 라우팅 방식 | 단순 라운드로빈 | 경로, 호스트, 쿼리 기반 라우팅 |
| 대상 그룹 | 없음 | 있음 (세분화된 제어) |
| 상태 확인 | 인스턴스 수준 | 대상 그룹 수준 |
| 컨테이너 지원 | 제한적 | 포트 매핑 포함 완전 지원 |
| 비용 효율성 | 애플리케이션 수만큼 필요 | 다수 앱을 하나의 ALB로 처리 가능 |

<br>

## 예시 구성
- ALB 하나가 `/users`, `/search` 등의 경로에 따라 서로 다른 대상 그룹으로 트래픽을 분산
- 대상 그룹 A: EC2 인스턴스 (유저 서비스)
- 대상 그룹 B: 온프레미스 서버 (검색 서비스)
- 쿼리 문자열 예시: `?Platform=Mobile` → A 그룹, `?Platform=Desktop` → B 그룹

<br>

## 정리
Application Load Balancer(ALB)는 **HTTP 기반 트래픽을 정교하게 라우팅**할 수 있는 AWS의 고급 로드 밸런서입니다. 경로, 호스트, 쿼리 등 다양한 기준으로 분산이 가능하며, **마이크로서비스와 컨테이너 환경에 최적화**되어 있습니다. 다수의 애플리케이션을 효율적으로 운영해야 하는 환경이라면 **ALB는 필수 도구**입니다.